<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="light dark"/>
  <script>
    (function () {
      try {
        var saved = localStorage.getItem("homepage-theme");
        var theme = (saved === "dark" || saved === "light")
          ? saved
          : (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", theme);
      } catch (e) {
        document.documentElement.setAttribute("data-theme", "light");
      }
    }());
  </script>

  <title>基于异窗宽GTWR模型的商品住宅价格影响因素研究 - PDF</title>

  <!-- PDF.js viewer 样式 -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/web/pdf_viewer.css"/>

  <style>
    :root{
      --bar-h:56px;
      --sidebar-w:320px;       /* 侧边栏更宽一点 */
    }

    html,body{
      height:100%;
      margin:0;
    }

    body{
      background:#f3f6f4;
      color:#1a1d21;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial;
      overflow:hidden;
    }

    /* 顶部工具条 --------------------------------------------------- */
    .topbar{
      position:fixed;
      inset:0 0 auto 0;
      height:var(--bar-h);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 16px;
      background:rgba(255,255,255,.9);
      backdrop-filter:blur(12px);
      border-bottom:1px solid #e6e8eb;
      z-index:20;
    }

    .topbar-left,
    .topbar-right{
      display:flex;
      align-items:center;
      gap:8px;
      min-width:0;
    }

    .topbar-title-wrap{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      pointer-events:none;
      max-width:60%;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .topbar-title{
      font-size:14px;
      font-weight:600;
      color:#1a1d21;
    }

    .btn{
      appearance:none;
      border:1px solid #d0d7de;
      background:#fff;
      color:#0d47a1;
      padding:6px 12px;
      border-radius:999px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
      transition:background .15s ease,border-color .15s ease,box-shadow .15s ease,transform .1s ease;
    }
    .btn:hover{
      background:#eef5ff;
      border-color:#b6c6e3;
      box-shadow:0 1px 4px rgba(15,23,42,.12);
      transform:translateY(-1px);
    }
    .btn:disabled{
      opacity:0.4;
      cursor:not-allowed;
      background:#f5f5f5;
    }
    .btn:disabled:hover{
      transform:none;
      box-shadow:none;
      background:#f5f5f5;
      border-color:#d0d7de;
    }
    .btn-icon{
      font-size:14px;
    }

    .btn-ghost{
      background:transparent;
      border-color:#dde1ea;
    }
    .btn-ghost:hover{
      background:#eef2ff;
    }

    .page-indicator{
      display:inline-flex;
      align-items:center;
      padding:6px 12px;
      font-size:13px;
      font-weight:600;
      color:#0d47a1;
      background:#f0f4f8;
      border-radius:999px;
      white-space:nowrap;
    }

    /* 左侧信息 / 目录侧栏 ------------------------------------------- */
    .side-panel{
      position:absolute;
      top:var(--bar-h);
      left:0;
      bottom:0;
      width:var(--sidebar-w);
      background:#ffffff;
      border-right:1px solid #dde1ea;
      transform:translateX(-100%);
      transition:transform .25s ease,box-shadow .25s ease;
      z-index:18;
      overflow:auto;
    }

    .side-panel-inner{
      padding:16px 18px 24px;
      font-size:13px;
      line-height:1.5;
    }

    .side-panel-header{
      border-bottom:1px solid #e5e7eb;
      padding-bottom:8px;
      margin-bottom:10px;
    }
    .side-panel-title{
      font-size:14px;
      font-weight:600;
      color:#0d47a1;
    }
    .side-panel-subtitle{
      margin-top:4px;
      font-size:11px;
      color:#9ca3af;
      text-transform:uppercase;
      letter-spacing:.06em;
    }

    .side-panel-section{
      margin-top:14px;
      margin-bottom:10px;
    }
    .side-panel-section h3{
      margin:0 0 6px;
      font-size:12px;
      font-weight:600;
      color:#374151;
      text-transform:none;
    }

    .meta-item{
      margin-bottom:4px;
      color:#4b5563;
    }
    .meta-label{
      color:#6b7280;
    }

    .toc-list{
      list-style:none;
      padding:0;
      margin:4px 0 0;
    }
    .toc-list li{
      margin-bottom:3px;
    }
    .toc-link{
      border:none;
      background:transparent;
      padding:4px 0;
      font-size:13px;
      color:#0d47a1;
      cursor:pointer;
      text-align:left;
      width:100%;
    }
    .toc-link:hover{
      text-decoration:underline;
    }

    body.sidebar-open .side-panel{
      transform:translateX(0);
      box-shadow:4px 0 18px rgba(15,23,42,.16);
    }

    /* 开合手柄（箭头） --------------------------------------------- */
    .side-toggle-handle{
      position:fixed;
      top:calc(var(--bar-h) + 12px);
      left:0;
      z-index:21;
      width:26px;
      height:44px;
      padding:0;
      border:none;
      border-radius:0 999px 999px 0;
      background:#0d47a1;
      color:#fff;
      font-size:18px;
      line-height:1;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:2px 2px 10px rgba(15,23,42,.3);
      transition:left .25s ease,border-radius .25s ease,box-shadow .25s ease;
    }

    body.sidebar-open .side-toggle-handle{
      left:var(--sidebar-w);
      border-radius:999px 0 0 999px;
      box-shadow:0 2px 12px rgba(15,23,42,.35);
    }

    /* PDF 容器 ----------------------------------------------------- */
    #viewerContainer{
      position:absolute;
      top:var(--bar-h);
      left:0;
      right:0;
      bottom:0;
      overflow:auto;
      background:#ffffff;
      transition:left .25s ease;
      scroll-behavior: smooth; 
    }
    body.sidebar-open #viewerContainer{
      left:var(--sidebar-w);
    }

    #viewer{
      padding:16px;
    }

    /* 缩放百分比浮标 ---------------------------------------------- */
    .zoom-indicator{
      position:fixed;
      right:16px;
      top:calc(var(--bar-h) + 16px);
      padding:6px 10px;
      font-size:12px;
      background:rgba(15,23,42,.9);
      color:#fff;
      border-radius:999px;
      box-shadow:0 4px 12px rgba(15,23,42,.35);
      opacity:0;
      pointer-events:none;
      transform:translateY(-6px);
      transition:opacity .25s ease,transform .25s ease;
      z-index:30;
    }
    .zoom-indicator.show{
      opacity:1;
      transform:translateY(0);
    }

    /* 加载遮罩 + 进度条 ------------------------------------------- */
    .loading-overlay{
      position:absolute;
      inset:var(--bar-h) 0 0 0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(243,246,244,.9);
      z-index:15;
      transition:opacity .3s ease;
    }
    .loading-overlay.hidden{
      opacity:0;
      pointer-events:none;
    }

    .loading-box{
      padding:16px 20px;
      border-radius:12px;
      background:#fff;
      box-shadow:0 12px 30px rgba(15,23,42,.18);
      min-width:220px;
    }
    .loading-text{
      font-size:13px;
      margin-bottom:10px;
      color:#1f2933;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .spinner{
      width:16px;
      height:16px;
      border-radius:999px;
      border:2px solid #d0e2ff;
      border-top-color:#0d47a1;
      animation:spin .7s linear infinite;
    }
    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    .loading-bar{
      position:relative;
      width:100%;
      height:4px;
      border-radius:999px;
      background:#e5edf7;
      overflow:hidden;
    }
    .loading-bar-fill{
      position:absolute;
      inset:0;
      width:0%;
      background:linear-gradient(90deg,#0d47a1,#42a5f5);
      transition:width .15s linear;
    }

    /* 自适应 ------------------------------------------------------- */
    @media (max-width:900px){
      .topbar{ padding:0 8px; }
      .topbar-title-wrap{ max-width:70%; }
      #viewer{ padding:8px; }

      .side-panel{
        width:80%;
        max-width:340px;
      }

      body.sidebar-open #viewerContainer{
        left:0;          /* 抽屉式覆盖, 不推开 PDF */
      }

      body.sidebar-open .side-toggle-handle{
        left:min(80vw, 340px);
      }
    }

    @media (max-width:600px){
      .topbar-right{ gap:4px; }
      .btn{ padding:5px 8px;font-size:12px; }
      .btn-icon{ font-size:13px; }
    }

    .topbar-right{
      overflow-x:auto;
      scrollbar-width:thin;
      scrollbar-color:#c5cfdd transparent;
    }
    .topbar-right::-webkit-scrollbar{
      height:6px;
    }
    .topbar-right::-webkit-scrollbar-thumb{
      background:#c5cfdd;
      border-radius:999px;
    }

    .btn:focus-visible,
    .toc-link:focus-visible,
    .side-toggle-handle:focus-visible{
      outline:2px solid #0d47a1;
      outline-offset:2px;
    }

    @media (max-width:900px){
      .topbar-title-wrap{ display:none; }
      .topbar-right{ margin-left:6px; }
    }

    @media (max-width:600px){
      :root{ --bar-h:60px; }
      .topbar{ padding:0 6px; }
      #fitWidthBtn,
      #fitPageBtn{
        display:none;
      }
      .page-indicator{
        padding:5px 8px;
        font-size:12px;
      }
    }

    :root[data-theme="dark"] body{
      background:#0f1722;
      color:#e5e7eb;
    }
    :root[data-theme="dark"] .topbar{
      background:rgba(15,23,34,.92);
      border-bottom-color:#2c394a;
    }
    :root[data-theme="dark"] .topbar-title{
      color:#e5e7eb;
    }
    :root[data-theme="dark"] .btn{
      background:#152131;
      color:#cfe0ff;
      border-color:#3b4d63;
    }
    :root[data-theme="dark"] .btn:hover{
      background:#203147;
      border-color:#5a7393;
      box-shadow:0 1px 6px rgba(0,0,0,.35);
    }
    :root[data-theme="dark"] .btn-ghost{
      background:transparent;
      border-color:#3b4d63;
    }
    :root[data-theme="dark"] .page-indicator{
      background:#1b2b3d;
      color:#aecdff;
    }
    :root[data-theme="dark"] .side-panel{
      background:#121d2b;
      border-right-color:#2c394a;
    }
    :root[data-theme="dark"] .side-panel-header{
      border-bottom-color:#2c394a;
    }
    :root[data-theme="dark"] .side-panel-title,
    :root[data-theme="dark"] .toc-link{
      color:#7fb2ff;
    }
    :root[data-theme="dark"] .meta-item,
    :root[data-theme="dark"] .meta-list .meta-value{
      color:#d1d9e6;
    }
    :root[data-theme="dark"] .meta-label,
    :root[data-theme="dark"] .side-panel-subtitle{
      color:#97a5b8;
    }
    :root[data-theme="dark"] .side-toggle-handle{
      background:#224a8f;
      box-shadow:2px 2px 10px rgba(0,0,0,.45);
    }
    :root[data-theme="dark"] #viewerContainer{
      background:#0f1722;
    }
    :root[data-theme="dark"] .loading-overlay{
      background:rgba(15,23,34,.92);
    }
    :root[data-theme="dark"] .loading-box{
      background:#152131;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    :root[data-theme="dark"] .loading-text{
      color:#d9e3f0;
    }
    :root[data-theme="dark"] .loading-bar{
      background:#223145;
    }

  </style>
</head>

<!-- 默认开启侧边栏 -->
<body class="sidebar-open">
  <div class="topbar">
    <div class="topbar-left">
      <a href="/index.html#publications"
         class="btn"
         onclick="event.preventDefault(); if(history.length>1){history.back();} else {location.href='/index.html#publications';}">
        <span class="btn-icon">←</span> 返回主页
      </a>
      <a class="btn btn-ghost" id="downloadLink" href="#" download>
        <span class="btn-icon">↓</span> 下载
      </a>
      <button class="btn btn-ghost" id="themeToggleBtn" type="button" title="切换到深色模式" aria-pressed="false">
        <span class="btn-icon">◐</span> <span id="themeLabel">夜间</span>
      </button>
    </div>

    <div class="topbar-title-wrap">
      <div class="topbar-title" style="font-size: large;"">
        基于异窗宽GTWR模型的商品住宅价格影响因素研究
      </div>
    </div>

    <div class="topbar-right">
      <button class="btn btn-ghost" id="prevPageBtn" title="上一页"><span class="btn-icon">←</span></button>
      <div class="page-indicator" id="pageIndicator">
        <span id="currentPage">1</span> / <span id="totalPages">-</span>
      </div>
      <button class="btn btn-ghost" id="nextPageBtn" title="下一页"><span class="btn-icon">→</span></button>
      <button class="btn btn-ghost" id="zoomOutBtn"><span class="btn-icon">－</span> 缩小</button>
      <button class="btn btn-ghost" id="zoomInBtn"><span class="btn-icon">＋</span> 放大</button>
      <button class="btn btn-ghost" id="fitWidthBtn">适宽</button>
      <button class="btn btn-ghost" id="fitPageBtn">适页</button>
      <button class="btn btn-ghost" id="resetZoomBtn">100%</button>
    </div>
  </div>

  <!-- 左侧信息 / 目录面板 -->
  <aside class="side-panel" id="sidePanel">
    <div class="side-panel-inner">
      <div class="side-panel-header">
      <div class="side-panel-title" style="font-size: 18px;">论文信息</div>
      <div class="side-panel-subtitle">ARTICLE DETAILS</div>
      </div>

      <div class="side-panel-section">
      <style>
        .meta-list { list-style: none; padding: 0; margin: 0; font-size: 13px; }
        .meta-list .meta-item { display: flex; gap: 0px; align-items: flex-start; padding: 6px 0; }
        .meta-list .meta-label { flex: 0 0 40px; width: 90px; color: #6b7280; font-weight: 600; }
        .meta-list .meta-value { flex: 1 1 auto; color: #374151; }
      </style>

      <ul class="meta-list">
        <li class="meta-item">
        <span class="meta-label" style="font-style: italic;">标题：</span>
        <span class="meta-value">基于异窗宽GTWR模型的商品住宅价格影响因素研究</span>
        </li>
        <li class="meta-item">
        <span class="meta-label" style="font-style: italic;">作者：</span>
        <span class="meta-value">侯健, 王芝皓, 田茂再, 窦燕</span>
        </li>
        <li class="meta-item">
        <span class="meta-label" style="font-style: italic;">期刊：</span>
        <span class="meta-value">数理统计与管理, 2022, 41(06): 1003-1014</span>
        </li>
        <li class="meta-item">
        <span class="meta-label" style="font-style: italic;">DOI:</span>
        <span class="meta-value">10.13860/j.cnki.sltj.20210722-025</span>
        </li>
      </ul>

      <h3 style="font-style: italic; font-size: 20px">摘要</h3>
      <div style="font-size: 13px; line-height: 1.5; color: #374151;">
        随着数据可获得性的增强,时空数据被广泛地应用在各个领域.以中国西部干旱区代表城市乌鲁木齐为研究对象,本文根据标准差椭圆加权算法与时空地理加权回归模型(GTWR)提出异常宽 GTWR 模型对房屋价格变动影响因素的时空变化进行研究.结果表明乌鲁木齐市住房价格的变动存在着明显的空间异质性,异常宽 GTWR模型对其的解释能力较好,标准差椭圆加权算法有效的减少了计算量,房价变动在空间上受交通便利性和绿化率等因素的影响较大,时间上受建筑年龄因素影响较大.
      </div>
      <div class="side-panel-section">
      <h3 style="font-style: italic; font-size: 20px">目录</h3>
      <ol class="toc-list">
        <li><button class="toc-link" data-page="1", style="font-size: 16px;">0、引言</button></li>
        <li><button class="toc-link" data-page="2", style="font-size: 16px;">1、研究方法</button></li>
        <li><button class="toc-link" data-page="4", style="font-size: 16px;">2、标准差椭圆分类算法</button></li>
        <li><button class="toc-link" data-page="7", style="font-size: 16px;">3、模拟实验</button></li>
        <li><button class="toc-link" data-page="9", style="font-size: 16px;">4、实证分析</button></li>
        <li><button class="toc-link" data-page="10", style="font-size: 16px;">5、结论</button></li>
      </ol>
      </div>
      <!-- 
      不要在这里加平滑滚动脚本, 主脚本已处理目录跳转. 
      如果要全局平滑滚动, 可在CSS加 scroll-behavior: smooth;
      -->
    </div>
  </aside>

  <!-- 开合手柄（箭头） -->
  <button id="sideToggleHandle" class="side-toggle-handle" aria-label="打开/关闭侧边信息">‹</button>

  <!-- 缩放百分比浮标 -->
  <div id="zoomIndicator" class="zoom-indicator">100%</div>

  <!-- 加载遮罩 -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-box">
      <div class="loading-text">
        <span style="display:flex;align-items:center;gap:8px;">
          <span class="spinner"></span>
          PDF 加载中…
        </span>
        <span id="loadingPercent">0%</span>
      </div>
      <div class="loading-bar">
        <div id="loadingBarFill" class="loading-bar-fill"></div>
      </div>
    </div>
  </div>

  <!-- PDF.js Viewer 容器 -->
  <div id="viewerContainer">
    <div id="viewer" class="pdfViewer"></div>
  </div>

  <!-- PDF.js 初始化 & 交互逻辑 -->
  <script type="module">
    const PDF_URL = "gtwr.pdf";
    document.getElementById('downloadLink').href = PDF_URL;

    const rootEl = document.documentElement;
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const themeLabel = document.getElementById("themeLabel");

    function readStoredTheme() {
      try {
        const saved = localStorage.getItem("homepage-theme");
        if (saved === "dark" || saved === "light") {
          return saved;
        }
      } catch (e) {}
      return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    }

    function applyTheme(theme) {
      const normalized = theme === "dark" ? "dark" : "light";
      rootEl.setAttribute("data-theme", normalized);
      if (themeToggleBtn && themeLabel) {
        themeToggleBtn.setAttribute("aria-pressed", String(normalized === "dark"));
        themeToggleBtn.title = normalized === "dark" ? "切换到浅色模式" : "切换到深色模式";
        themeLabel.textContent = normalized === "dark" ? "日间" : "夜间";
      }
      try {
        localStorage.setItem("homepage-theme", normalized);
      } catch (e) {}
    }

    applyTheme(readStoredTheme());
    if (themeToggleBtn) {
      themeToggleBtn.addEventListener("click", () => {
        applyTheme(rootEl.getAttribute("data-theme") === "dark" ? "light" : "dark");
      });
    }

    import * as pdfjsLib from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.mjs";
    import { EventBus, PDFLinkService, PDFFindController, PDFViewer }
      from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/web/pdf_viewer.mjs";

    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.mjs";

    const eventBus      = new EventBus();
    const linkService   = new PDFLinkService({ eventBus });
    const findController= new PDFFindController({ eventBus, linkService });

    const container = document.getElementById("viewerContainer");
    const viewer    = new PDFViewer({
      container,
      eventBus,
      linkService,
      findController,
      textLayerMode: 1,
      annotationMode: 2,
    });
    linkService.setViewer(viewer);
    window.viewer = viewer; // 让全局 window.viewer 可用

    /* 加载进度条 -------------------------------------------------- */
    const overlay   = document.getElementById("loadingOverlay");
    const percentEl = document.getElementById("loadingPercent");
    const barFillEl = document.getElementById("loadingBarFill");

    function showOverlay(){ overlay.classList.remove("hidden"); }
    function hideOverlay(){ overlay.classList.add("hidden"); }

    showOverlay();

    const CMAP_URL          = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/cmaps/";
    const STANDARD_FONT_URL = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/standard_fonts/";

    const loadingTask = pdfjsLib.getDocument({
      url: PDF_URL,
      cMapUrl: CMAP_URL,
      cMapPacked: true,
      standardFontDataUrl: STANDARD_FONT_URL,
    });

    loadingTask.onProgress = ({ loaded, total }) => {
      if (!total) return;

      // 计算并截断到 [0, 100]
      let p = Math.round((loaded / total) * 100);
      p = Math.max(0, Math.min(p, 100));

      percentEl.textContent = p + "%";
      barFillEl.style.width = p + "%";
    };

    let pdfDocument = null;
    try {
      pdfDocument = await loadingTask.promise;
    } catch (error) {
      percentEl.textContent = "失败";
      barFillEl.style.width = "100%";
      const box = overlay.querySelector(".loading-box");
      if (box) {
        box.innerHTML = `
          <div class="loading-text"><span>PDF 加载失败</span></div>
          <div style="font-size:12px;color:#6b7280;line-height:1.6;margin-bottom:10px;">请检查网络连接，或直接下载原文查看。</div>
          <a class="btn" href="${PDF_URL}" download><span class="btn-icon">↓</span> 下载 PDF</a>
        `;
      }
      console.error("Failed to load PDF:", error);
      throw error;
    }

    viewer.setDocument(pdfDocument);
    linkService.setDocument(pdfDocument, null);

    /* 页码显示和导航 ------------------------------------------- */
    const currentPageEl = document.getElementById("currentPage");
    const totalPagesEl = document.getElementById("totalPages");
    const prevPageBtn = document.getElementById("prevPageBtn");
    const nextPageBtn = document.getElementById("nextPageBtn");

    prevPageBtn.title = "上一页 (←)";
    nextPageBtn.title = "下一页 (→)";
    document.getElementById("zoomOutBtn").title = "缩小 (-)";
    document.getElementById("zoomInBtn").title = "放大 (+)";
    document.getElementById("fitWidthBtn").title = "适宽 (W)";
    document.getElementById("fitPageBtn").title = "适页 (F)";
    document.getElementById("resetZoomBtn").title = "100% (R)";

    // 更新页码显示
    function updatePageIndicator() {
      const currentPage = viewer.currentPageNumber;
      const totalPages = pdfDocument.numPages;
      currentPageEl.textContent = currentPage;
      totalPagesEl.textContent = totalPages;
      
      // 更新按钮状态
      prevPageBtn.disabled = currentPage <= 1;
      nextPageBtn.disabled = currentPage >= totalPages;
    }

    // 监听页面变化
    eventBus.on("pagechanging", () => {
      updatePageIndicator();
    });

    // 上一页
    prevPageBtn.addEventListener("click", () => {
      if (viewer.currentPageNumber > 1) {
        viewer.currentPageNumber--;
      }
    });

    // 下一页
    nextPageBtn.addEventListener("click", () => {
      if (viewer.currentPageNumber < pdfDocument.numPages) {
        viewer.currentPageNumber++;
      }
    });

    eventBus.on("pagesinit", () => {
      viewer.currentScaleValue = "page-fit";
      setTimeout(hideOverlay, 300);
      updateZoomIndicator();
      updatePageIndicator(); // 初始化页码显示
    });

    /* 缩放控制 & 浮标 --------------------------------------------- */
    const zoomIndicator = document.getElementById("zoomIndicator");
    let zoomTimer = null;

    function showZoomIndicator(){
      zoomIndicator.classList.add("show");
      if(zoomTimer) clearTimeout(zoomTimer);
      zoomTimer = setTimeout(() => {
        zoomIndicator.classList.remove("show");
      }, 800);
    }

    function updateZoomIndicator(){
      const value = Math.round(viewer.currentScale * 100);
      zoomIndicator.textContent = value + "%";
    }

    function setScale(scaleValue){
      viewer.currentScaleValue = scaleValue;
      updateZoomIndicator();
      showZoomIndicator();
    }

    document.getElementById("zoomInBtn").addEventListener("click", () => {
      const newScale = Math.min(viewer.currentScale * 1.1, 4.0);
      setScale(newScale);
    });

    document.getElementById("zoomOutBtn").addEventListener("click", () => {
      const newScale = Math.max(viewer.currentScale / 1.1, 0.25);
      setScale(newScale);
    });

    document.getElementById("fitWidthBtn").addEventListener("click", () => {
      setScale("page-width");
    });

    document.getElementById("fitPageBtn").addEventListener("click", () => {
      setScale("page-fit");
    });

    document.getElementById("resetZoomBtn").addEventListener("click", () => {
      setScale(1.0);
    });

    eventBus.on("scalechanging", (evt) => {
      if (typeof evt.scale === "number") {
        updateZoomIndicator();
        showZoomIndicator();
      }
    });

    /* 侧边栏开合（箭头手柄） ------------------------------------- */
    const body           = document.body;
    const sideHandle     = document.getElementById("sideToggleHandle");

    function syncHandle(){
      const opened = body.classList.contains("sidebar-open");
      sideHandle.textContent = opened ? "‹" : "›";
      sideHandle.setAttribute("aria-label", opened ? "收起侧边信息" : "展开侧边信息");
    }

    sideHandle.addEventListener("click", () => {
      body.classList.toggle("sidebar-open");
      syncHandle();
    });

    // ESC 关闭侧栏
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        body.classList.remove("sidebar-open");
        syncHandle();
      }
    });

    syncHandle(); // 初始化箭头方向

    /* 键盘快捷键 ------------------------------------------------ */
    document.addEventListener("keydown", (e) => {
      const target = e.target;
      const tagName = target && target.tagName ? target.tagName.toLowerCase() : "";
      if (tagName === "input" || tagName === "textarea" || (target && target.isContentEditable)) {
        return;
      }

      if (e.key === "ArrowLeft") {
        e.preventDefault();
        prevPageBtn.click();
      } else if (e.key === "ArrowRight") {
        e.preventDefault();
        nextPageBtn.click();
      } else if (e.key === "+" || e.key === "=") {
        e.preventDefault();
        document.getElementById("zoomInBtn").click();
      } else if (e.key === "-" || e.key === "_") {
        e.preventDefault();
        document.getElementById("zoomOutBtn").click();
      } else if (e.key.toLowerCase() === "w") {
        e.preventDefault();
        setScale("page-width");
      } else if (e.key.toLowerCase() === "f") {
        e.preventDefault();
        setScale("page-fit");
      } else if (e.key.toLowerCase() === "r") {
        e.preventDefault();
        setScale(1.0);
      }
    });

    /* 目录点击跳转到指定页 ---------------------------------------- */
    document.querySelectorAll(".toc-link").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const p = parseInt(btn.dataset.page,10);
        if(Number.isFinite(p)){
          viewer.scrollPageIntoView({ pageNumber: p });
        }
      });
    });
  </script>

  <noscript>需要启用 JavaScript 才能预览 PDF. </noscript>
</body>
</html>
